<!doctype html>
<!--
	opsebf.js
	One particle in static electric and magnetic field
	
	Sparisoma Viridi | dudung@gmail.com
	
	20180619
	Create this based on gstd.js application.
-->
<html>
<head>
<!--
<script
	src="https://raw.githack.com\
	/dudung/butiran/\
	master/dist/butiran.js"
	>
</script>
-->
<script src="butiran.js"></script>

<!-- remove this when deploy openly in distribution -->
<!-- since 20180619.0300                            -->
<script src="../lib/log/log.js"></script>
<!-- ---------------------------------------------- -->

</head>
<body>
<script>
// Define some global variables
var m, q, r, v;
var EField, BField;
var t, dt, tbeg, tend;
var Tdata, sample;
var proc;
var tabs1, tabs2, bgroup;

// Call main function
main()

// Define main function
function main() {
	// Set layout of elements
	setLayout();
	
	// Log something
	log();
		
	// Set timer for processing simulation
	proc = new Timer(simulate, 10);
}

// Perform simulation
function simulate() {
	// Format time t
	t = +t.toFixed(10);
	
	// Apply Newton second law of motion
	{}
	
	// Integrate using Euler algorithm
	{}
	
	// Display result in certain period of time
	if(sample.sampling()) {
		tabs1.text("Results").push(t);
		var textarea = tabs1.element("Results");
		textarea.scrollTop = textarea.scrollHeight;
	}
	
	// Terminate simulation when end time is reached
	if(t >= tend) {
		proc.stop();
		var btn = document.getElementById("simulation");
		btn.disabled = "disabled";
		btn.innerHTML = "Start";
	}
	
	// Increase time t
	t += dt;
}

// Set layout of elements
function setLayout() {
	// Define first Tabs
	tabs1 = new Tabs("tabs1");
	tabs1.setWidth("300px");
	tabs1.setHeight("240px");
	tabs1.addTab("Log", 0);
	tabs1.addTab("Params", 0);
	tabs1.addTab("Results", 0);
	
	// Clear tabs1
	tabs1.text("Params").clear();
	tabs1.text("Results").clear();
	tabs1.text("Log").clear();
	
	// Define second Tabs
	tabs2 = new Tabs("tabs2");
	tabs2.setWidth("300px");
	tabs2.setHeight("300px");
	tabs2.addTab("xy", 1);
	tabs2.addTab("yz", 1);
	tabs2.addTab("zx", 1);
	tabs2.addTab("xyz", 1);
	
	// Define bgroup
	bgroup = new Bgroup("bgroup");
	bgroup.setWidth("60px");
	bgroup.setHeight("105px");
	bgroup.addButton("Load", 1);
	bgroup.addButton("Read", 0);
	bgroup.addButton("Start", 0);
	bgroup.addButton("Help", 1);
	bgroup.addButton("About", 1);
}

// Load parameters
function loadParameters() {
	tabs1.text("Params").push("MASS 1");
	tabs1.text("Params").push("CHARGE 1");
	tabs1.text("Params").push("VELOCITY 1 0 0");
	tabs1.text("Params").push("POSITION 0 0 0");
	tabs1.text("Params").push("MAGNFIELD 0 0 1");
	tabs1.text("Params").push("ELECFIELD 0 0 1");
	tabs1.text("Params").push("GRAVFIELD 0 0 0");
	tabs1.text("Params").push("MOMEFIELD 0 0 0");
	tabs1.text("Params").push("TSTEP 1E-3");
	tabs1.text("Params").push("TDATA 1E-1");
	tabs1.text("Params").push("TBEG 0");
	tabs1.text("Params").push("TEND 1.5");
}
	
// Get parameters
function readParameters() {
	var text = tabs1.element("Params").value;
	m = Parse.getFrom(text).valueOf("MASS");
	q = Parse.getFrom(text).valueOf("CHARGE");
	r = Parse.getFrom(text).valueOf("POSITION");
	v = Parse.getFrom(text).valueOf("VELOCITY");
	EField = Parse.getFrom(text).valueOf("ELECFIELD");
	BField = Parse.getFrom(text).valueOf("MAGNFIELD");
	tbeg = Parse.getFrom(text).valueOf("TBEG");
	tend = Parse.getFrom(text).valueOf("TEND");
	dt = Parse.getFrom(text).valueOf("TSTEP");
	Tdata = Parse.getFrom(text).valueOf("TDATA");
	
	// Initiate time
	t = tbeg;
	
	// Set sampling
	sample = new Sample(Tdata, dt);
}	

// Log something and show manually	
function log() {
	try { 
		console.log(
			showOnly(logjs).forFilter(
				{
					app: "opsebf",
					date: "20180619",
					after: "1500",
				}
			)
		);
	}
	catch(err) {
		var msg = "opsebf logs only in development stage";
		console.warn(msg);
	}
}

// Do something when buttons clicked
function buttonClick(event) {
	var target = event.target;
	
	if(target.innerHTML == "Start") {
		target.innerHTML = "Stop";
		proc.start();
		tabs1.text("Log").push("Simulation is starting");
	} else if(target.innerHTML == "Stop"){
		target.innerHTML = "Start";
		proc.stop();
		tabs1.text("Log").push("Simulation stopped");
	}
	
	if(target.innerHTML == "About") {
		alert(
			"opsebf | "
			+ "One particle in static electric and magnetic field"
			+ "\n"
			+ "Version 20180619"
			+ "\n"
			+ "Based on butiran "
			+ "| https://github.com/dudung/butiran"
			+ "\n"
			+ "MIT License | "
			+ "Copyright (c) 2018 Sparisoma Viridi"
		);
		tabs1.text("Log").push("About is called");
	}
	
	if(target.innerHTML == "Help") {
		alert(
			"Help"
		);
		tabs1.text("Log").push("Help is called");
	}
	
	if(target.innerHTML == "Load") {
		loadParameters();
		tabs1.text("Log").push("Default parameters are loaded");
	}
	
	if(target.innerHTML == "Read") {
		readParameters();
		tabs1.text("Log").push("Parameters are read");
	}
}
</script>
</body>
</html>